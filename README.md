# NER数据标注工具

一个基于Streamlit的命名实体识别（NER）数据标注工具，支持实体标注、多类别映射和项目管理功能。

## 功能特性

### 🎯 核心功能
- **实体标注**：在文本中标注实体并分配标签
- **多类别映射**：将标注实体映射到具体的属性类别
- **项目管理**：支持多项目管理和数据持久化
- **词表管理**：支持自定义词表和自动候选词生成
- **可视化标注**：直观的实体高亮显示

### 📊 标注流程
1. **选择文本** → **标注实体** → **映射类别** → **导出数据**

## 安装和运行

### 环境要求
- Python 3.7+
- Streamlit
- Pandas

### 安装步骤

1. 克隆项目或下载代码文件
2. 安装依赖包：
```bash
pip install streamlit pandas
```

3. 运行应用：
```bash
streamlit run app.py
```

### 项目结构
```
ner_label/
├── app.py                 # 主应用文件
├── utils/
│   ├── annotation.py     # 标注管理工具
│   └── mapping.py        # 词表映射工具
└── data/
    └── projects/         # 项目数据存储目录
```

## 使用指南

### 1. 创建新项目

1. 在侧边栏选择"新建项目"
2. 输入项目名称
3. 上传数据文件（支持格式：CSV、Excel、JSON）
   - 文件必须包含 `query` 列
   - 可选包含 `annotations` 列（已有标注数据）

### 2. 数据标注

#### 实体标注步骤：
1. **选择文本**：在查询文本中复制要标注的实体
2. **粘贴实体**：将文本粘贴到"实体文本"输入框
3. **选择标签**：从下拉菜单中选择合适的实体标签
4. **添加标注**：点击"添加标注"按钮确认

#### 支持的实体标签：
- 品类、品牌、型号、年份、价格
- CPU、GPU、内存、存储
- 屏幕尺寸、屏幕分辨率
- 颜色、重量、AI相关
- 其他自定义标签

### 3. 映射标注

对于每个标注的实体，可以映射到具体的属性类别：

- **品类映射**：category
- **品牌映射**：brand  
- **CPU映射**：cpu_brand, cpu_series, cpu_family, cpu_model, cpu_gen
- **GPU映射**：gpu_type, gpu_brand, gpu_series, gpu_model
- **内存映射**：memory_capacity_gb
- **存储映射**：storage_capacity_gb
- 等等...

### 4. 词表管理

#### 上传词表：
- 支持JSON格式的词表文件
- 词表结构示例：
```json
{
  "brand": ["苹果", "华为", "小米"],
  "category": ["手机", "笔记本", "平板"],
  "cpu_brand": ["Intel", "AMD", "苹果"]
}
```

#### 添加候选词：
在映射界面可以直接添加新的候选词到词表。

### 5. 导航和导出

#### 导航功能：
- 进度条显示标注进度
- 滑动条快速跳转样本
- 上一页/下一页按钮
- 标注状态指示器

#### 导出功能：
- 下载完整的标注数据（CSV格式）
- 复制当前样本的标注数据
- 自动保存到项目文件

## 数据格式

### 输入数据格式
支持CSV、Excel、JSON格式，必须包含 `query` 列：
```csv
query
"苹果iPhone 15 Pro 256GB 黑色"
"华为MateBook 14 2023款 i5处理器"
```

### 输出数据格式
导出的CSV文件包含原始数据和标注信息：
```csv
query,annotations
"苹果iPhone 15 Pro",[{"text": "苹果", "label": "品牌", "start": 0, "end": 2, "mapped_value": {"brand": ["苹果"]}}, ...]
```

## 项目文件说明

在 `data/projects/` 目录下，每个项目会生成以下文件：
- `项目名.csv/.json` - 原始数据
- `项目名_annotations.json` - 标注数据
- `项目名_vocab.json` - 项目词表
- `项目名_label_map.json` - 标签-类别映射

## 自定义配置

### 添加新标签
在侧边栏的"标签管理"部分可以：
- 添加新的实体标签
- 删除不需要的标签

### 修改标签映射
通过上传标签-类别映射文件来自定义映射关系：
```json
{
  "品类": ["category"],
  "品牌": ["brand"],
  "CPU": ["cpu_brand", "cpu_series"]
}
```

## 注意事项

1. **数据备份**：定期备份 `data/projects/` 目录
2. **文件编码**：建议使用UTF-8编码保存文件
3. **词表更新**：修改词表后需要重新加载项目
4. **标注一致性**：建议制定标注规范确保一致性

## 故障排除

### 常见问题

**Q: 上传文件失败**
A: 检查文件格式和编码，确保包含必需的 `query` 列

**Q: 标注无法保存**
A: 检查项目目录的写入权限

**Q: 词表加载失败**
A: 验证JSON格式是否正确

## 技术支持

如有问题或建议，请检查：
1. 控制台错误信息
2. 文件格式和编码
3. 依赖包版本兼容性

---
